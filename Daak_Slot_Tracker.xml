<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Monday, December 18, 2017, 7:36 PM -->
<!-- MuClient version 5.06-pre -->

<!-- Plugin "Daak_Slot_Tracker" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Daak_Slot_Tracker"
   author="Daak"
   id="a3de94e76283851d667e9b26"
   language="Lua"
   purpose="Tracks slot gold spent"
   save_state="y"
   date_written="2017-12-18 19:34:51"
   requires="5.06"
   version="1.0"
   >
<description trim="y">
<![CDATA[
Keeps track of slot gold spent and earned
]]>
</description>

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Plugin help  -->

<aliases>
  <alias
    match="^dslot (?&lt;cmd&gt;.*)$"
    script="dslot_cmd"
    name="dslot_cmd"
    enabled="y" regexp="y" sequence="100" ignore_case="y"
    >
  </alias>
</aliases>

<triggers>
  <trigger
   enabled="y"
   match="^You put ([0-9,]+) coins into the machine and spin!$"
   name="daak_slot_spent"
   script="daak_slot_spent"
   sequence="100"
   regexp="y"
   group="daak_slots"
   omit_from_output="n"
  >
  </trigger>
  <trigger
   enabled="y"
   match="^Game pays: 0 credits$"
   name="daak_slot_loser"
   script="daak_slot_loser"
   sequence="100"
   regexp="y"
   group="daak_slots"
   omit_from_output="n"
  >
  </trigger>
  <trigger
   enabled="y"
   match="^Congratulations! You win ([0-9,]+) gold coins!$"
   name="daak_slot_win"
   script="daak_slot_win"
   sequence="100"
   regexp="y"
   group="daak_slots"
   omit_from_output="n"
  >
  </trigger>
</triggers>

<aliases>
  <alias
   script="OnHelp"
   match="Daak_Slot_Tracker:help"
   enabled="y"
  >
  </alias>
</aliases>

<script>
<![CDATA[
internalrevision = "$Rev$"

require "tprint"
require "serialize"

slot_spent = tonumber(GetVariable("slot_spent")) or 0
slot_won = tonumber(GetVariable("slot_won")) or 0
slot_spins = tonumber(GetVariable("slot_spins")) or 0

function dslot_cmd (name, line, wildcards)
  local cmd = wildcards.cmd
  if cmd ~= "status" and cmd ~= "help" then
    Note("Invalid dslot command - try: dslot <status|reset|help>")
    return
  end
  if cmd == "help" then
    show_help()
    return
  end
  if cmd == "reset" then
    reset_vars()
    return
  end
  show_status()
end -- prac_start

function daak_slot_spent(name, line, wildcards)
  if wildcards[1] == nil then
    return
  end
  slot_spins = (slot_spins + 1)
  local spent = string.gsub(wildcards[1], ",", "")
  Note(spent)
  spent = tonumber(spent)
  slot_spent = (slot_spent + spent)
  Note("Record " .. spent .. " more spent on slots, total = " .. slot_spent .. " in " .. slot_spins)
end

function daak_slot_win(name, line, wildcards)
  if wildcards[1] == nil then
    return
  end
  local won = string.gsub(wildcards[1], ",", "")
  Note(won)
  won = tonumber(won)
  slot_won = slot_won + won
  Note("Won! Total spent " .. slot_spent .. " in " .. slot_spins .. " spins has won " .. slot_won)
  Note("Net winning = " .. (slot_won - slot_spent))
end

function daak_slot_loser(name, line, wildcards)
  Note("Lost! Total spent " .. slot_spent .. " in " .. slot_spins .. " spins has won " .. slot_won)
  Note("Net winning = " .. (slot_won - slot_spent))
end

function show_status()
  Note("Spins = " .. slot_spins)
  Note("Net winning = " .. (slot_won - slot_spent))
end --show_status

function reset_vars()
  slot_spent = 0
  slot_won = 0
  slot_spins = 0
  SetVariable("slot_spent", slot_spent)
  SetVariable("slot_won", slot_won)
  SetVariable("slot_spins", slot_spins)
end -- reset_vars

function show_help ()
  Note("Help for Daak's Slot Tracker:\n")
  Tell(padRight("  dslot status", 16, " "))
  Note(": Show your spins and winnings/losings")
  Tell(padRight("  dslot reset", 16, " "))
  Note(": Reset the spins/amounts")
  Tell(padRight("  dslot help", 16, " "))
  Note(": You're looking at it\n")
end -- show_help

function OnHelp ()
  world.Note (world.GetPluginInfo (world.GetPluginID (), 3))
end

function OnPluginInstall()
  slot_spent = tonumber(GetVariable("slot_spent")) or 0
  slot_won = tonumber(GetVariable("slot_won")) or 0
  slot_spins = tonumber(GetVariable("slot_spins")) or 0
end

function OnPluginSaveState ()
  SetVariable("slot_spent", slot_spent)
  SetVariable("slot_won", slot_won)
  SetVariable("slot_spins", slot_spins)
end

-- Utils
function padRight(text, length, padChar)
  local padding = length - string.len(text)
  for i = 1, padding do
    text = text .. padChar
  end
  return text
end

]]>
</script> 

</muclient>
